generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "windows", "darwin", "darwin-arm64", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

// Modelo de Usuarios del sistema IC
model IC_Users {
  id            Int       @id(map: "PK__IC_Users__3213E83F3650DF97") @default(autoincrement())
  username      String    @unique(map: "UQ__IC_Users__F3DBC5723100E9EF") @db.NVarChar(100)
  password_hash String    @db.NVarChar(200)
  role          String    @default("user", map: "DF__IC_Users__role__70DDC3D8") @db.NVarChar(50)
  created_at    DateTime? @default(dbgenerated("sysutcdatetime()"), map: "DF__IC_Users__create__71D1E811")
  email         String    @unique @default("", map: "DF__IC_Users__email__75A278F5") @db.NVarChar(200)
  is_active     Boolean   @default(true, map: "DF__IC_Users__is_act__76969D2E")
  updated_at    DateTime? @default(dbgenerated("sysutcdatetime()"), map: "DF__IC_Users__update__778AC167") @updatedAt

  @@map("IC_Users")
}

// Modelo de Logs de operaciones
model IC_Logs {
  id            Int       @id(map: "PK__IC_Logs__3213E83FB9DAC845") @default(autoincrement())
  user          String    @db.NVarChar(100)
  folio_interno String    @db.NVarChar(150)
  action        String    @db.NVarChar(200)
  details       String?   @db.NVarChar(Max)
  created_at    DateTime? @default(now())
  cliente       String?   @db.NVarChar(200)
  status        String    @default("PENDIENTE") @db.NVarChar(20)
  cliente_code  String?   @db.NVarChar(50)
  updated_by    String?   @db.NVarChar(100)
  updated_at    DateTime? @updatedAt
  
  codes         IC_Codes[]

  @@index([status], map: "IX_IC_Logs_status")
  @@index([folio_interno], map: "IX_IC_Logs_folio_interno")
  @@index([cliente_code], map: "IX_IC_Logs_cliente_code")
  @@index([user, created_at(sort: Desc)], map: "IX_IC_Logs_user_date")
  @@index([cliente, created_at(sort: Desc)], map: "IX_IC_Logs_cliente_date")
  @@map("IC_Logs")
}

// Modelo de CÃ³digos IC relacionados con logs
model IC_Codes {
  id         Int       @id(map: "PK__IC_Codes__3213E83F1CAF7DE9") @default(autoincrement())
  log_id     Int
  producto   String    @db.NVarChar(100)
  codigo_ic  String    @db.NVarChar(100)
  created_at DateTime  @default(now())
  
  log        IC_Logs   @relation(fields: [log_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([log_id], map: "IX_IC_Codes_log_id")
  @@index([log_id, producto], map: "IX_IC_Codes_log_producto")
  @@map("IC_Codes")
}
